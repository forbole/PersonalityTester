<!DOCTYPE html>
<html lang="en">
  <head>
    <title>My Recipe App</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/gh/IdentityModel/oidc-client-js@1.10.1/dist/oidc-client.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/auth0/jwt-decode@2.2.0/build/jwt-decode.js"></script>
    <link rel="stylesheet" type="text/css" href="../style.css" />
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
  </head>
  <body>
    <div class="main">
      <div id="response">
        <div id="data"></div>
         <!--  <button id="myData" data-cy="myData"></button> -->
        <h2>Welcome to All My Chard</h2>
        <!-- like button to see which post (0-11) to like -->
        <h2>Like which post?</h2>
        <form>
          <label for="fname">Post number:</label><br>
          <input type="text" id="like-post-name" name="like-post-name" id="like_post_id"><br>
          <input type="button" value="Like!" id="like-button">
        </form>
        <!-- Comment on which post? -->
        <h2>Comment which post?</h2>
        <form>
          <label for="fname">Post number:</label><br>
          <input type="text" id="comment_post_id" name="comment_post_id" data-cy="comment_post_id"><br>
          <label for="fname">Comment:</label><br>
          <input type="text" id="comment_post_text" name="comment_post_text" data-cy="comment_post_text"><br>
          <input type="button" value="Comment!" id="comment-button">
        </form>
        <!-- #region snippet-show -->
        <span>Your user id is</span>
        <button id="user-id" data-cy="user-id"></button>
        <!-- #endregion snippet-show -->
        <button id="grant-access-oasis" data-cy="grant-access-oasis">
          I want to share my recipes!
        </button>
      </div>
    </div>
    <div class="footer">
      <p class="credit">Photo by Brooke Lark on Unsplash</p>
    </div>
    <!-- #region snippet-receive -->
    <script src="callback/appoloconfig.js" type="text/javascript"></script>
    <script src="config.js" type="text/javascript"></script>
    <script>
    import uploadsToParcel  from './action';

    document.getElementById("comment-button").onclick = function() {(comment_click())};
    document.getElementById("like-button").onclick = function() {(like_click())};

    function like_click() {
        upload(parseInt(document.getElementById('like_post_id').value));
    }

    export function comment_click(){
      console.log("clicked")
      var postId = document.getElementById('comment_post_id').value;
      var comment = document.getElementById('comment_post_text').value;
      upload(parseInt(postId),comment);
    }

    function upload(postId,comment=""){
        var userID = document.getElementById('user-id').innerText;
        console.log(jsonlist.posts[postId].message)
        //uploadsToParcel(userID,jsonlist.posts[postId].message+" "+comment)
    }

    </script>
    <script>
      Oidc.Log.logger = console;
      Oidc.Log.level = Oidc.Log.DEBUG;
      const oidcClient = new Oidc.OidcClient(config);
      (async function() {
        try {
          const response = await oidcClient.processSigninResponse(location.href);
          const IDToken = response.id_token;
          const decoded = jwt_decode(IDToken);
          const address = decoded.sub;
          console.log(`ID token:\n${JSON.stringify(decoded, null, '')}`);
          document.getElementById('user-id').innerText = `${address}`;
          document.getElementById('grant-access-oasis').addEventListener('click', function () {
            location.assign(grantUrl(address));
          });
        } catch (error) {
          document.getElementById('user-id').hidden = true;
          document.getElementById('grant-access-oasis').hidden = true;
          document.getElementById('response').innerText = `${error}`;
        }
      })();

    </script>
    <!-- #endregion snippet-receive -->
  </body>
</html>
